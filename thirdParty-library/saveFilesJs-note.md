[fileSaveJs- Saving generated files on the client-side](#top)

- [General](#general)
- [Using Http Header](#using-http-header)
- [Using a form element (POST methods)](#using-a-form-element-post-methods)
- [Using a[download]](#using-adownload)
- [Using Ajax + FileSaver](#using-ajax--filesaver)
  - [Plain vanilla XMLHttpRequest](#plain-vanilla-xmlhttprequest)
  - [Fetch API](#fetch-api)
  - [Angulars 1.x $http](#angulars-1x-http)

## General

- using W3C File API to implements FileSaver in all modern browsers.
- note: if file is bigger than the blob's size limitation or don't have enough RAM, then have a look at the more advanced [StreamSaver.js](https://github.com/jimmywarting/StreamSaver.js)

```javascript
//installation
npm install file-saver --save
npm install @types/file-saver --save-dev
//1) Import library
var FileSaver = require('file-saver');
//or
import { saveAs } from 'file-saver';
//2) saving text
var blob = new Blob(["Hello, world!"], {type: "text/plain;charset=utf-8"});
FileSaver.saveAs(blob, "hello world.txt");
//3) Saving URLs
FileSaver.saveAs("https://httpbin.org/image", "image.jpg");
//4) saving a canvas
var canvas = document.getElementById("my-canvas");
canvas.toBlob(function(blob) {
    saveAs(blob, "pretty image.png");
});
//5) saving file
var file = new File(["Hello, world!"], "hello world.txt", {type: "text/plain;charset=utf-8"});
FileSaver.saveAs(file);
```

## Using Http Header

- `Content-Disposition` attachment header is the best preferred way to download files from the browser. It has better cross browser compatibility, won't have any memory limit and it doesn't require any JavaScript.
- `Content-Disposition: attachment; filename="filename.jpg"; filename*="filename.jpg"`

## Using a form element (POST methods)

- If the file is generated using a POST request

```javascript
var data = JSON.stringify(postData);
var form = $('<form />');
form.attr('action', downloadUrl);
form.attr('method', 'post');
form.attr('target', '_blank');
form.attr('enctype', 'application/x-www-form-urlencoded');
// create input
var input = $('<input />');
input.attr('type', 'hidden');
input.attr('name', 'payload');
input.val(data);
// append input and form
form.append(input);
$('body').append(form);
form.submit().remove();  // submit and remove form
```

## Using a[download]

- `<a href="uploads/screenshot.png" download="cat.png">download cat.png</a>`
- This attribute instructs browsers to download a URL instead of navigating to it,
-Note: 
  - This attribute can be used with blob: URLs and data: URLs to download content generated by JavaScript, such as pictures created in an image-editor Web app.
  - If the HTTP header Content-Disposition: gives a different filename than this attribute, the HTTP header takes priority over this attribute.
  - If Content-Disposition: is set to inline, Firefox prioritizes Content-Disposition, like the filename case, while Chrome prioritizes the download attribute.

## Using Ajax + FileSaver

### Plain vanilla XMLHttpRequest

```javascript
var xhr = new XMLHttpRequest()
xhr.open(method, url)
xhr.responseType = 'blob'
xhr.onload = function() {
  FileSaver.saveAs(xhr.response, filename);
}
xhr.send()
```

### Fetch API

```javascript
// ES7
const res = await fetch(url)
const blob = await res.blob()
saveAs(blob, fileName)
// ES6
fetch(url)
  .then(res => res.blob())
  .then(blob => saveAs(blob, fileName))

// ES5
fetch(url)
  .then(function(res) {
    return res.blob()
  })
  .then(function(blob) {
    saveAs(blob, fileName)
  })
```

### Angulars 1.x $http

```javascript
$http({
  url: "http://localhost:8080/filename.zip",
  responseType: "blob"
}).then(function(response) {
  saveAs(response.data, fileName)
})
Angulars http
import {ResponseContentType } from '@angular/http'
@Injectable()
export class AngularService {

    constructor(private http: Http) {}

    download(model: MyModel) { //get file from service
        this.http.post("http://localhost/a2/pdf.php", JSON.stringify(model), {
            method: RequestMethod.Post,
            responseType: ResponseContentType.Blob,
            headers: new Headers({'Content-Type', 'application/x-www-form-urlencoded'})
        }).subscribe(
            response => { // download file
                var blob = new Blob([response.blob()], {type: 'application/pdf'});
                var filename = 'file.pdf';
                saveAs(blob, filename);
            },
            error => {
                console.error(`Error: ${error.message}`);
            }
        );
    }
}
```

[back to top](#top)

> References
- https://github.com/eligrey/FileSaver.js/wiki/Saving-a-remote-file#directives
- [Saving generated files on the client-side](https://eligrey.com/blog/saving-generated-files-on-the-client-side/)
